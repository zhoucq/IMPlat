@using Imp.Core.Domain.Users
@model Imp.Admin.Models.Users.UserModel
@{
    ViewBag.Title = "新建用户";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}
@{
    IList<Role> allRoles = ViewBag.AllRoles;
}

@using (Html.BeginForm())
{
    <div class="box round first">
        <h2>新建用户</h2>
        <div class="block">
            <h5>
                <input type="submit" class="btn btn-blue" value="保存" />
                <input type="button" class="btn btn-grey" value="返回" onclick="location.href='@Url.Action("Index", "Doc")    '" />
            </h5>
        </div>

        <table class="form">
            <tr>
                <td class="col1">@Html.LabelFor(m => m.Username)</td>
                <td>@Html.EditorFor(m => m.Username)
                    @Html.ValidationMessageFor(m => m.Username)
                </td>
            </tr>
            <tr>
                <td class="col1">@Html.LabelFor(m => m.Password)</td>
                <td>@Html.PasswordFor(m => m.Password)
                    @Html.ValidationMessageFor(m => m.Password)
                </td>
            </tr>
            <tr>
                <td class="col1">@Html.LabelFor(m => m.Password2)</td>
                <td>@Html.PasswordFor(m => m.Password2)
                    @Html.ValidationMessageFor(m => m.Password2)
                </td>
            </tr>
            <tr>
                <td class="col1">@Html.LabelFor(m => m.DisplayName)</td>
                <td>
                    @Html.EditorFor(m => m.DisplayName)
                    @Html.ValidationMessageFor(m => m.DisplayName)
                </td>
            </tr>
            <tr>
                <td>
                    @Html.LabelFor(m => m.AvailableRoles)
                </td>
                <td>
                    @Html.CheckBoxListFor(m => m.PostedRoles,
                    m => m.AvailableRoles,
                    e => e.Id,
                    e => e.Name,
                    m => m.SelectedRoles)
                    @Html.ValidationMessageFor(m => m.PostedRoles, "必须选择一个角色")
                </td>
            </tr>
        </table>
    </div>
}

<script>
    var validator;
    $(function() {
        validator = $('form').validate(
            {
                "rules": {
                    "DisplayName":"required"
                }, "messages": {
                    DisplayName: "请选择至少一项角色"
                }
            }
        
        );
    });
</script>
@*<form role="form" id="formCreateUser" method="post" action="@Url.Action("Create", "Account")">
    <div class="panel panel-default">
        <div class="panel-heading">
            创建用户 <a href="@Url.Action("List", "Account")" class="small">(返回用户列表)</a>
            <div class="pull-right">
                <input type="submit" class="btn btn-sm btn-primary" name="save" value="保存" />
                <input type="submit" class="btn btn-sm btn-primary" name="continueEditing" value="保存并继续添加" />
            </div>
        </div>
        <div class="panel-body">



            <input type="hidden" name="continueEdit" id="continueEdit" />
            <div class="form-group">
                <label for="username">登录名</label>
                <input type="text" class="form-control" name="username" id="username" placeholder="登录名" />
            </div>
            <div class="form-group">
                <label for="password">密码</label>
                <input type="password" class="form-control" name="password" id="password" placeholder="密码">
            </div>
            <div class="form-group">
                <label for="password2">重复密码</label>
                <input type="password" class="form-control" name="password2" id="password2" placeholder="重复密码">
            </div>
            <div class="form-group">
                <label for="displayName">姓名</label>
                <input type="text" class="form-control" name="displayName" id="displayName" placeholder="姓名">
            </div>
            <div class="form-group">
                <label>角色</label>
                <div>
                    @foreach (var role in allRoles)
                    {
                        <label class="checkbox-inline">
                            <input type="checkbox" id="role" name="role" value="@role.Id">
                            @role.Name
                        </label>
                    }
                </div>
            </div>
            <div class="form-group">
                <button class="btn btn-primary" type="submit">保存</button>
                <a href="@Url.Action("List", "Account")" class="btn btn-default">返回</a>
            </div>

        </div>
    </div>
</form>
<script type="text/javascript">
    var validator;
    $(document).ready(function () {
        validator = $("#formCreateUser").validate({
            rules: {
                username: "required",
                displayName: "required",
                role: "required",
                password: "required",
                password2: {
                    required: true,
                    equalTo: "#password"
                }
            },
            messages: {
                username: "请输入用户名",
                displayName: "请输入姓名",
                role: "请选择至少一项角色",
                password: "密码不能为空",
                password2: {
                    required: "重复密码不能为空",
                    equalTo: "输入的密码不匹配"
                }
            }, errorPlacement: function (error, element) {
                if (element.is(":radio"))
                    error.appendTo(element.parent().next().next());
                else if (element.is(":checkbox")) {
                    error.appendTo(element.parent().parent().siblings());
                }
                else
                    error.appendTo(element.siblings());
            }
        });

    });

</script>*@
